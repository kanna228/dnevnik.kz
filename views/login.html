<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–æ–π—Ç–∏</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/static/login.css">
</head>
<body>
    <!-- –•–µ–¥–µ—Ä -->
    <header class="header">
        <a href="/" class="logo">Dnevnik.kz</a>
        <nav>
            <ul>
                <li><a href="/list">–°–ø–∏—Å–æ–∫</a></li>
                <li><a href="/help">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a></li>
                <li><a href="/dashboard">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a></li>
                <li><a href="/about">–û –Ω–∞—Å</a></li>
                <li><a href="/contact">–ê–¥–º–∏–Ω</a></li>
            </ul>
        </nav>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main>
        <h1>–í—Ö–æ–¥ –£—á–µ–Ω–∏–∫</h1>
        <form id="loginForm">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>

            <label for="password">–ü–∞—Ä–æ–ª—å:</label>
            <input type="password" id="password" name="password" required>

            <button type="submit" class="btn">–í–æ–π—Ç–∏</button>
        </form>

        <div class="button-group">
            <a href="/teacher_login" class="btn">–í–æ–π—Ç–∏ –∫–∞–∫ —É—á–∏—Ç–µ–ª—å</a>
            <p>–ò–ª–∏</p>
            <a href="/register" class="btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
        </div>
    </main>

    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
    <script>
        const API_BASE = window.location.hostname === "localhost" 
            ? "http://localhost:8080/api" 
            : "https://dnevnik-kz.onrender.com/api"; 
    
        document.getElementById("loginForm").addEventListener("submit", async (e) => {
            e.preventDefault();
    
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
    
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password }), 
                });
        
                const data = await response.text(); // –ß–∏—Ç–∞–µ–º –æ—Ç–≤–µ—Ç –∫–∞–∫ —Ç–µ–∫—Å—Ç
        
                if (response.ok) {
                    const jsonData = JSON.parse(data); // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ç–µ–∫—Å—Ç –≤ JSON
                    const token = jsonData.token;
                    const userId = jsonData.user_id;
        
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –∏ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage
                    localStorage.setItem("jwt", token);
                    localStorage.setItem("user_id", userId);
        
                    console.log("‚úÖ Logged in! Stored user_id:", userId);
                    alert("–í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏!");
                    window.location.href = "/dashboard"; 
                } else {
                    // –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å)
                    if (data.includes("User not found")) {
                        alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω.");
                    } else if (data.includes("Invalid password")) {
                        alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.");
                    } else {
                        alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: " + data);
                    }
                }
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", error);
                alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—Ö–æ–¥–∞.");
            }
        });
    
        // Check if user is already logged in
        window.addEventListener("load", () => {
            const token = localStorage.getItem("jwt");
            const userId = localStorage.getItem("user_id");
            console.log("üìù Checking stored data:", { token, userId });
    
            if (token && userId) {
                window.location.href = "/dashboard";
            }
        });
    </script>
    
    
    
</body>
</html>