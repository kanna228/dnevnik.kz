<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–æ–π—Ç–∏</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/static/login.css">
</head>
<body>
    <!-- –•–µ–¥–µ—Ä -->
    <header class="header">
        <a href="/" class="logo">Dnevnik.kz</a>
        <nav>
            <ul>
                <li><a href="/list">–°–ø–∏—Å–æ–∫</a></li>
                <li><a href="/teachers">–£—á–∏—Ç–µ–ª—è</a></li>
                <li><a href="/login">–í–æ–π—Ç–∏</a></li>
                <li><a href="/about">–û –Ω–∞—Å</a></li>
                <li><a href="/contact">–ê–¥–º–∏–Ω</a></li>
            </ul>
        </nav>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main>
        <h1>–í—Ö–æ–¥ –£—á–µ–Ω–∏–∫</h1>
        <form id="loginForm">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>

            <label for="password">–ü–∞—Ä–æ–ª—å:</label>
            <input type="password" id="password" name="password" required>

            <button type="submit" class="btn">–í–æ–π—Ç–∏</button>
        </form>

        <div class="button-group">
            <a href="/teacher_login" class="btn">–í–æ–π—Ç–∏ –∫–∞–∫ —É—á–∏—Ç–µ–ª—å</a>
            <p>–ò–ª–∏</p>
            <a href="/register" class="btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
        </div>
    </main>

    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
    <script>
        const API_BASE = window.location.hostname === "localhost" 
            ? "http://localhost:8080/api" 
            : "https://dnevnik-kz.onrender.com/api"; 
    
        document.getElementById("loginForm").addEventListener("submit", async (e) => {
            e.preventDefault();
    
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
    
            const response = await fetch(`${API_BASE}/login`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password }), 
            });
    
            if (response.ok) {
                const data = await response.json();
                const token = data.token;
                const userId = data.user_id; // Retrieve user ID from response
    
                // Store token and user ID in localStorage
                localStorage.setItem("jwt", token);
                localStorage.setItem("user_id", userId);
    
                console.log("‚úÖ Logged in! Stored user_id:", userId);
                alert("–í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏!");
                window.location.href = "/dashboard"; 
            } else {
                const errorData = await response.json(); 
                console.error("Server error:", errorData); 
                alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å.");
            }
        });
    
        // Check if user is already logged in
        window.addEventListener("load", () => {
            const token = localStorage.getItem("jwt");
            const userId = localStorage.getItem("user_id");
            console.log("üìù Checking stored data:", { token, userId });
    
            if (token && userId) {
                window.location.href = "/dashboard";
            }
        });
    </script>
    
    
    
</body>
</html>